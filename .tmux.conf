# My plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'NHDaly/tmux-better-mouse-mode'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'catppuccin/tmux'

set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
# set -ag terminal-overrides ",xterm-256color:RGB,tmux-256color:RGB"

# make sure tmux knows to use nushell
set -g default-command "nu"
set -g default-shell "/run/current-system/sw/bin/nu"

# Prefix key
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# Indices
set -g base-index 1 # window indices start from 1 instead of 0 for easier reach
set -g renumber-windows on # closing a window will rename the rest to fit
set -g pane-base-index 1

# Quality of life
set -g mouse on
set-option -g history-limit 5000
set -g renumber-windows on



# Better splits
unbind %
bind "|" split-window -h -c "#{pane_current_path}"
bind "\\" split-window -fh -c "#{pane_current_path}"
unbind '"'
bind "-" split-window -v -c "#{pane_current_path}"
bind "_" split-window -fv -c "#{pane_current_path}"

# Window/session switching
bind Space last-window
bind-key C-Space switch-client -l

# make my super cool dev env windows
bind v split-window -h -p 15 -c "#{pane_current_path}" 'opencode' \; \
       select-pane -L \; \
       split-window -v -p 25 -c "#{pane_current_path}" \; \
       send-keys 'source ~/.config/nushell/top-3-ps.nu' C-m \; \
       select-pane -U \; \
       send-keys 'nvim .' C-m


# vim-tmux-navigator (move from neovim to other tmux panes)
set -g @vim_navigator_mapping_left "C-Left C-h"  # use C-h and C-Left
set -g @vim_navigator_mapping_right "C-Right C-l"
set -g @vim_navigator_mapping_up "C-k"
set -g @vim_navigator_mapping_down "C-j"
set -g @vim_navigator_mapping_prev ""  # removes the C-\ binding

# Copy mode (vim style)
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind Escape copy-mode

# Reload config
# Don't forget to nix-fast rebuild before you reload the config
# bind r source-file /etc/tmux.conf \; display-message "Config reloaded!"
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Paste buffer
unbind p
bind p paste-buffer

# Bind 'l' to open URLs from the current pane
unbind l
bind l run-shell -b "tmux capture-pane -J -p | rg -o '(https?://[^\s>]+)' | fzf-tmux -d20 --multi --bind 'alt-a:select-all,alt-d:deselect-all' | xargs -r xdg-open"

# move areound windows
bind H previous-window
bind L next-window

# set -g status-position top
set -g status-position bottom
# Catppuccin theme
# set -g @catppuccin_flavour 'macchiato'
set -g @catppuccin_flavour 'mocha'

# load catppuccin files
run ~/.tmux/plugins/catppuccin/tmux/catppuccin.tmux

# set -g @catppuccin_window_tabs_enabled on
# set -g @catppuccin_date_time "%H:%M"
# set -g @catppuccin_window_left_separator ""
# set -g @catppuccin_window_right_separator " "
# set -g @catppuccin_window_middle_separator " █"
# set -g @catppuccin_window_number_position "right"
# set -g @catppuccin_window_default_fill "number"
# set -g @catppuccin_window_default_text "#W"
# set -g @catppuccin_window_current_fill "number"
# set -g @catppuccin_status_modules_right "directory" # date_time"
# set -g @catppuccin_status_modules_left "session"
# set -g @catppuccin_status_left_separator  " "
# set -g @catppuccin_status_right_separator " "
# set -g @catppuccin_status_right_separator_inverse "no"
# set -g @catppuccin_status_fill "icon"
# set -g @catppuccin_status_connect_separator "no"
# set -g @catppuccin_directory_text "#{b:pane_current_path}"



# Make the status line pretty and add some modules
set -g status-right-length 100
set -g status-left-length 100
set -g status-left ""
set -ag status-left "#{E:@catppuccin_status_session}"
set -g status-right "#{E:@catppuccin_status_application}"
set -ag status-right "#{E:@catppuccin_status_host}"

# Flat separators for status modules
# set -g @catppuccin_window_left_separator  " █"
set -g @catppuccin_window_left_separator  " █"
set -g @catppuccin_window_right_separator " "
set -g @catppuccin_window_middle_separator " "
# set -g @catppuccin_status_left_separator  " █"
set -g @catppuccin_status_left_separator  "█"
set -g @catppuccin_status_right_separator " "

set -ag @catppuccin_window_current_text "#W#{?window_zoomed_flag,(),}"

# Other Catppuccin options
set -g @catppuccin_window_tabs_enabled on
set -g @catppuccin_status_modules_left "session"
set -g @catppuccin_status_modules_right "directory"

# Resurrect/Continuum
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-boot 'on'
set -g @continuum-save-interval '10'
set -g @continuum-restore 'on'

# Initialize TMUX plugin manager (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
